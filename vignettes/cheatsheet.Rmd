---
title: "DurgaPlot Cheat Sheet"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{DurgaPlot Cheat Sheet}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}

---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(DurgaPlot)
library(datasets)
data(iris)
```


This vignette shows some examples of plots that can be generated by the `DurgaPlot` package. Each plot is preceded by the code used to generate it, which can be used to learn how to create the plot. Before plotting your data, you must estimate the differences in group means by calling `DurgaDiff`. 

The plotting order of the groups can be controlled by specifying the `groups` parameter. Not all groups in the data need be included in the analysis or plot. To assign display labels to the groups, use a named vector to list the groups. The names will be used to label the groups on the plot. 

In the damselfly data set, the groups are `juvenile` and `adult`. The example below demonstrates how to change the displayed group names as well as the display order of the groups.



```{r fig.height=4, fig.width=8}
par(mfrow = c(1, 2), mar = c(5, 4, 4, 5))
d <- DurgaDiff(damselfly, "weight", "group", na.rm = TRUE)
DurgaPlot(d, main = "Default display")

d <- DurgaDiff(damselfly, "weight", "group", na.rm = TRUE,
                   groups = c("Immature" = "juvenile", "Mature" = "adult"))
DurgaPlot(d, main = "Groups labelled and ordered")
```

A `DurgaPlot` is a combination of one or more visual components: data `points`, `violin` plots, `bar` charts, `box` plots, a mean or median indicator (`central.tendency`) and error bars (`error.bars`). Each component is controlled by a set of parameters to `DurgaPlot`. The names of the parameters indicate the component they apply to, so to adjust the violin plot component, read the documentation about all parameters starting with `violin`. we have attempted to define sensible default values for parameters, so for example, if you turn on bar charts, violin plots and the central tendency indicator will be turned off. You are free to override the defaults if you wish.

The colours of all components can controlled using the appropriate parameters. A single colour may be specified, or different colours can be set for each group. Points can be coloured individually or by group. The default `pch` for points is 19.

```{r fig.height=5, fig.width=8.5}
par(mfrow = c(1, 2), mar = c(10, 4, 3, 6) + 0.1)
d <- DurgaDiff(iris, data.col = "Sepal.Length", group.col = "Species",
                   groups = c("versicolor", "setosa"))
DurgaPlot(d, 
        points = c(DurgaTransparent("coral", .6), DurgaTransparent("darkturquoise", .8)),
        violin = c("red", "blue"), violin.fill = c("#f8a8c840", "#a8c8f840"), 
        main = "Two colours")

par(mar = c(5, 4, 3, 1) + 0.1)
d <- DurgaDiff(iris, data.col = "Sepal.Length", group.col = "Species")
DurgaPlot(d, violin = "grey50", violin.fill = "grey90", violin.shape = "left", 
        points = "black", 
        points.params = list(pch = 22, cex = 0.8, 
                             bg = c("pink", "lightblue", "darkolivegreen3")[iris$Species]),
        main = "Coloured point fill")
```

Error bars on each group may show the 95% confidence intervals of the mean, standard deviation or standard error, and may be plotted regardless of what other components are shown.
 
```{r fig.height=6, fig.width=9}
par(mfrow = c(1, 2))
d <- DurgaDiff(iris, data.col = "Sepal.Length", group.col = "Species")
DurgaPlot(d, bar = TRUE, error.bars.type = "SD", points = FALSE, violin = FALSE, 
        main = "Bar chart with std. deviation")

DurgaPlot(d, error.bars.type = "CI", central.tendency = rainbow(3), 
        points = FALSE, violin = FALSE, main = "Mean and 95% CI")
```

By default, effect sizes are "unstandardised", which means they are in the same units as the data. Alternatively, `DurgaDiff` can estimate standardised effect sizes, either Cohen's d or Hedges' g, which allow comparisons of effect sizes across data in different units.

You can override the y-axis labels to aid interpretation of effect sizes. `DurgaPlot` does not provide text labels by default because effect size interpretation depends on context.

```{r fig.height=6, fig.width=8}
par(mar = c(5, 9, 3, 1) + 0.1)
effectSizes <- c("No effect" = 0, "Large positive effect" = 0.8, "Huge positive effect" = 2)
groups <- c("Self" = "self_fertilised", "Westerham" = "westerham_cross", "Inter" = "inter_cross")
d <- DurgaDiff(petunia, 1, 2, effect.type = "cohens", groups = groups)
DurgaPlot(d, violin = F, main = "Cohen's d, labelled effect size", 
          points.method = "jitter", 
          ef.size.ticks = effectSizes, ef.size.label = "", ef.size.las = 1)
```

Groups can be offset horizontally from their default positions. Individual components (i.e. violins, points etc.) can be offset independently.

```{r fig.height=5, fig.width=7}
par(mar = c(5, 4, 3, 1) + 0.1)
set.seed(1)
# Construct some data
data <- data.frame(Measurement = unlist(lapply(c(10, 12, 8, 8.5, 9, 9.1), function(m) rnorm(20, m))),
                   Group = rep(paste0("g", 1:6), each = 20),
                   Id = rep(1:6, 20))
groups = c("Control 1" = "g1", "Treatment 1" = "g2", 
           "Control 2" = "g3", "Treatment 2" = "g4", 
           "Control 3" = "g5", "Treatment 3" = "g6")
d <- DurgaDiff(data, 1, 2, 3, groups = groups, 
                   contrasts = "g2 - g1, g4 - g3, g6 - g5")
# Reduce text size
par(cex = 0.7)
DurgaPlot(d, box = TRUE, group.dx = c(0.15, -0.15), paired = FALSE, points = FALSE, 
        box.pars = list(boxwex = 0.4), ef.size.violin = FALSE, main = "Group offsets",
        xlim = c(1, 6))
```

Any unknown parameters to `DurgaPlot` are passed on to the plot function, which allows some control over additional aspects of the plot. The labels underneath effect sizes can be controlled by passing a named vector for the `DurgaPlot` `contrasts` parameter.

```{r fig.height=5, fig.width=7}
# Add in some fake sex data to the insulin data set
data <- cbind(insulin, Sex = sample(c("Male", "Female"), nrow(insulin), replace = TRUE))
# Thin it the data so individual symbols are visible
data <- data[data$id %in% 1:15, ]

d <- DurgaDiff(data, "sugar", "treatment", "id", 
                   groups = c("Before insulin" = "before", "After insulin" = "after"), na.rm = TRUE)
par(mar = c(2, 4, 4, 1))
DurgaPlot(d, 
          frame.plot = FALSE, # Don't draw containing box
          contrasts = c("Sugar change" = "after - before"),
          left.ylab = "Blood sugar level",
          violin.shape = c("left", "right"), violin.dx = c(-0.055, 0.055), violin.width = 0.3, 
          points = "black",
          points.params = list(bg = ifelse(data$Sex == "Female", "red", "blue"), 
                               pch = ifelse(data$Sex == "Female", 21, 24)), 
          ef.size.pch = 19,
          ef.size.violin = "blue",
          ef.size.violin.shape = "full",
          central.tendency = FALSE,
          main = "Customised plot")
legend("topright", c("Female", "Male"), pch = c(21, 24), pt.bg = c("red", "blue"))
```

